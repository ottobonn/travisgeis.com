<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.8a856ac569de13b8b669.css" data-identity="gatsby-global-css">@font-face{font-family:Travis Print One;src:url(/static/TravisPrintOne-Regular-395b4112e8d8e4c008f2f27beb638a30.woff2) format("woff2")}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2b2b2b}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#d4d0ab}.token.punctuation{color:#fefefe}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ffa07a}.token.boolean,.token.number{color:#00e0e0}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#abe338}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#00e0e0}.token.atrule,.token.attr-value,.token.function{color:gold}.token.keyword{color:#00e0e0}.token.important,.token.regex{color:gold}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media screen and (-ms-high-contrast:active){code[class*=language-],pre[class*=language-]{background:window;color:windowText}:not(pre)>code[class*=language-],pre[class*=language-]{background:window}.token.important{background:highlight;color:window;font-weight:400}.token.atrule,.token.attr-value,.token.function,.token.keyword,.token.operator,.token.selector{font-weight:700}.token.attr-value,.token.comment,.token.doctype,.token.function,.token.keyword,.token.operator,.token.property,.token.string{color:highlight}.token.attr-value,.token.url{font-weight:400}}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}:root{--accent-color:#6a39ff;--code-font:"Anonymous Pro";--code-padding:2em;--code-size:75%;--font-name:"Spectral";--font-size:24px;--header-font:"Rubik",sans-serif;--link-underline:underline;--neutral-background-color:#f9f9f9;--title-box-offset:0.5rem;--title-top-margin:1rem;--link-color:var(--accent-color);--boxy-color:var(--accent-color);--wide-width:100%;--wide-margin-left:0}body{font-family:var(--font-name);font-size:var(--font-size)}h1,h2,h3,h4,h5,h6{font-family:var(--header-font);line-height:1.28571429em;margin:calc(2rem - .14286em) 0 1rem}h1:first-child,h2:first-child,h3:first-child,h4:first-child,h5:first-child,h6:first-child{margin-top:-.14285714em}h1:last-child,h2:last-child,h3:last-child,h4:last-child,h5:last-child,h6:last-child{margin-bottom:0}.boxy,.gatsby-resp-image-wrapper,p>img{background-color:#fff;border:2px solid #000;box-shadow:var(--title-box-offset) var(--title-box-offset) 0 var(--boxy-color)}.gatsby-resp-image-wrapper,p>img{margin-left:var(--wide-margin-left)!important;width:var(--wide-width)}.video-container{background-color:#fff;border:2px solid #000;box-shadow:var(--title-box-offset) var(--title-box-offset) 0 var(--boxy-color);height:0;margin-bottom:2rem;margin-top:2rem;padding-bottom:56.25%;position:relative;width:100%}.video-container iframe{height:100%;left:0;position:absolute;top:0;width:100%}stl-viewer{display:block;height:500px;width:100%}code{font-family:var(--code-font)!important}:not(pre)>code{background-color:#eee!important;border-radius:0!important;color:#000!important;padding:.2em!important}.gatsby-highlight{background-color:#fff;border:2px solid #000;box-shadow:var(--title-box-offset) var(--title-box-offset) 0 var(--boxy-color);margin:.5em 0;margin-left:var(--wide-margin-left);overflow:auto;width:var(--wide-width)}.gatsby-highlight pre[class*=language-]{border-radius:0;margin:0;overflow:hidden;padding:var(--code-padding)}.gatsby-highlight pre[class*=language-] code{display:block;overflow:auto}.gatsby-highlight pre[class*=language-].line-numbers{font-size:var(--code-size);padding-left:3em}.gatsby-highlight pre[class*=language-].line-numbers .line-numbers-rows{border-right:none;left:1em!important;opacity:.5;top:var(--code-padding)}</style><meta name="generator" content="Gatsby 3.15.0"/><title data-react-helmet="true">Software PWM on the ATtiny13</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Spectral|Rubik|Anonymous+Pro" rel="stylesheet"/><link data-react-helmet="true" rel="apple-touch-icon-precomposed" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png"/><link data-react-helmet="true" rel="apple-touch-icon-precomposed" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png"/><link data-react-helmet="true" rel="apple-touch-icon-precomposed" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png"/><link data-react-helmet="true" rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png"/><link data-react-helmet="true" rel="apple-touch-icon-precomposed" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png"/><link data-react-helmet="true" rel="apple-touch-icon-precomposed" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png"/><link data-react-helmet="true" rel="apple-touch-icon-precomposed" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png"/><link data-react-helmet="true" rel="apple-touch-icon-precomposed" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicons/favicon-196x196.png" sizes="196x196"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicons/favicon-128.png" sizes="128x128"/><meta data-react-helmet="true" name="application-name" content="travisgeis.com"/><meta data-react-helmet="true" name="msapplication-TileColor" content="#FFFFFF"/><meta data-react-helmet="true" name="msapplication-TileImage" content="/favicons/mstile-144x144.png"/><meta data-react-helmet="true" name="msapplication-square70x70logo" content="/favicons/mstile-70x70.png"/><meta data-react-helmet="true" name="msapplication-square150x150logo" content="/favicons/mstile-150x150.png"/><meta data-react-helmet="true" name="msapplication-wide310x150logo" content="/favicons/mstile-310x150.png"/><meta data-react-helmet="true" name="msapplication-square310x310logo" content="/favicons/mstile-310x310.png"/><script data-react-helmet="true" type="module" src="/stl-viewer/stl-viewer.js"></script><style data-styled="" data-styled-version="5.3.0">.cnoNVM{max-width:1024px;margin-left:auto;margin-right:auto;}/*!sc*/
data-styled.g4[id="Layout__Container-sc-1arw8t8-0"]{content:"cnoNVM,"}/*!sc*/
.goernf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}/*!sc*/
data-styled.g5[id="Menu__MenuContainer-zgpfzl-0"]{content:"goernf,"}/*!sc*/
.hRhFsN{-webkit-text-decoration:none;text-decoration:none;font-family:var(--header-font);-webkit-flex:1;-ms-flex:1;flex:1;text-align:center;padding:0.5em;border-radius:0.25em;color:inherit;}/*!sc*/
.hRhFsN:hover{background-color:#eee;}/*!sc*/
data-styled.g6[id="Menu__MenuLink-zgpfzl-1"]{content:"hRhFsN,"}/*!sc*/
.jmvzGK{border:2px solid black;background-color:white;box-shadow:var(--title-box-offset) var(--title-box-offset) 0 var(--boxy-color);padding:1rem;margin-top:var(--title-top-margin);margin-bottom:2rem;}/*!sc*/
.jmvzGK a:hover{-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g7[id="Titles__TitleDiv-sc-5xl7gs-0"]{content:"jmvzGK,"}/*!sc*/
</style><link as="script" rel="preload" href="/webpack-runtime-d8157e8dded65c3ff337.js"/><link as="script" rel="preload" href="/framework-065c3db88fdd2b546387.js"/><link as="script" rel="preload" href="/app-8b28952f62241afbe9f6.js"/><link as="script" rel="preload" href="/component---src-pages-post-slug-tsx-d0a722fe664509218382.js"/><link as="fetch" rel="preload" href="/page-data/2012/01/11/software-pwm-on-the-attiny13/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="Layout__Container-sc-1arw8t8-0 cnoNVM"><div class="page"><div id="content"><div id="menu" class="Menu__MenuContainer-zgpfzl-0 goernf menu"><a class="Menu__MenuLink-zgpfzl-1 hRhFsN item" href="/"><i class="icon home"></i>travisgeis.com</a><a class="Menu__MenuLink-zgpfzl-1 hRhFsN item" href="/contact"><i class="icon comments"></i>Contact</a></div><div id="titles" class="Titles__TitleDiv-sc-5xl7gs-0 jmvzGK"><h1>Software PWM on the ATtiny13</h1><h3>11 January 2012</h3></div><i>About a <!-- -->4<!-- -->-minute read</i><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1200px">
      <a class="gatsby-resp-image-link" href="/static/ca55b07d2a4635c56cac58e66ac9d406/dbfb1/IMG_2929-e1326866475822.jpg" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:134%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIFAwH/xAAWAQEBAQAAAAAAAAAAAAAAAAACAwD/2gAMAwEAAhADEAAAAZa0Oi0kcw1qSEWc2JU//8QAGxAAAwADAQEAAAAAAAAAAAAAAQIDABARBBL/2gAIAQEAAQUC5jDUIrUUn9jJuVJ9CCbMWOkA5//EABcRAAMBAAAAAAAAAAAAAAAAAAABERL/2gAIAQMBAT8BSpBOGT//xAAXEQEAAwAAAAAAAAAAAAAAAAAAARES/9oACAECAQE/AVpaf//EAB8QAAEDAwUAAAAAAAAAAAAAAAEAAhARElEgITFBof/aAAgBAQAGPwKSS7fCJbyPYuaru8Kp0f/EAB4QAQACAgEFAAAAAAAAAAAAAAEAESExQRBRYXGh/9oACAEBAAE/Ifa5piHaYiLhxPDhSqhG9QOlJKS2+4vrVj0VkT//2gAMAwEAAgADAAAAECDsPv/EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAwEBPxASgSSUQk2//8QAFxEBAQEBAAAAAAAAAAAAAAAAATEAEP/aAAgBAgEBPxAEvRIzf//EAB4QAQADAAICAwAAAAAAAAAAAAEAESExUUFxYYGx/9oACAEBAAE/EEq0wcEBMmGst5+4l4sAt6L36lIeMFS7Dx6gEKEyk4nkrI8J0w6Y3hfe318xDE7cqZGsjvMXordT/9k=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="A first go at the Stardweeny using an ATtiny13" title="A first go at the Stardweeny using an ATtiny13" src="/static/ca55b07d2a4635c56cac58e66ac9d406/e5166/IMG_2929-e1326866475822.jpg" srcSet="/static/ca55b07d2a4635c56cac58e66ac9d406/f93b5/IMG_2929-e1326866475822.jpg 300w,/static/ca55b07d2a4635c56cac58e66ac9d406/b4294/IMG_2929-e1326866475822.jpg 600w,/static/ca55b07d2a4635c56cac58e66ac9d406/e5166/IMG_2929-e1326866475822.jpg 1200w,/static/ca55b07d2a4635c56cac58e66ac9d406/d9c39/IMG_2929-e1326866475822.jpg 1800w,/static/ca55b07d2a4635c56cac58e66ac9d406/dbfb1/IMG_2929-e1326866475822.jpg 1936w" sizes="(max-width: 1200px) 100vw, 1200px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><p>This year for the holidays I created a little dynamic ornament with five
channels of independent LED light. The prototype, which had to be finished in a
matter of days, used an Ardweeny board from Solarbotics. The Ardweeny is based
on the ATmega328, a great chip with more than five hardware channels for PWM
(pulse-width modulation). While I love the ATmega chips, they get a bit pricey
at $5 apiece just to drive some LEDs.</p><p>I was shopping on Digi-Key for alternatives and decided to try a couple of
ATtiny13 microcontrollers. The ATtiny13 is a small, low-power AVR with the
standard 8-bit core size, and conveniently comes with a 9.6-MHz internal RC
oscillator. Because the ATtiny has an internal oscillator, I knew I could keep
my hardware very minimal and thus very small, a requirement for the small paper
ornament I was hoping to build.</p><p>The problem is that the ATtiny13 has only one PWM output. If I used only its
hardware functionality, I would get one channel of control, where I needed five.
To solution is to implement a simple software PWM. In this post I describe my
process of getting software PWM (and embedded C programming in general) working
on the ATtiny13.</p><p>The first step with programming any part is reading the datasheet <!-- -->[link]<!-- -->. The
Attiny13 comes with 1KB of internal flash memory for programs. When I ordered it
this sounded plenty large for my purposes, but I forgot to account for the heavy
Arduino libraries I’m used to using, whose needed functionality I would have to
implement myself in the code. 1KB turns out to feel like a tiny amount of space.</p><p>1KB is too small to hold the floating-point math libraries of AVR-LibC, the C
library I use for AVR programs. It’s also too small to hold the math.h library,
which includes the trigonometry functions. In my ‘328-based prototype I used a
sin() function to calculate the brightness levels of the light channels, to give
a soothing light pulsation. That won’t be an option on the tiny13.</p><p>I had a lot of trouble getting started with C on the ATtiny. It’s not too
complicated once you get going, though.</p><h2>Implementing Software PWM</h2><p>Software PWM uses an inbuilt functionality of the microcontroller called a
timer. The timer counts off clock cycles, and when it reaches a certain point,
in this case its maximum value of 255 (the max value of a single unsigned byte),
the timer triggers an interrupt.</p><p>The interrupt is important precisely because it interrupts the running code.
Specifically, it tells the microcontroller to jump to a predefined location in
program memory, execute the instructions there, and then return to the main
routine. For software-based PWM, the timer interrupt is perfect. It frees up the
main program logic by periodically and consistently executing the same function,
called an Interrupt Service Routine.</p><p>So the desired program flow looks like this:</p><div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset:linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	loop infinitely<span class="token punctuation">,</span> changing the output levels
	accordingly<span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token function">ISR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	run now <span class="token operator">and</span> then<span class="token punctuation">,</span> twiddling the hardware
	outputs to correspond with the output levels
	set in main
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>The main function in my case was supposed to set the output level of each of
five LEDs such that one LED would “lead” the others in a gentle up-down
pulsation. The ISR would be responsible for dealing with the actual on-off
settings of the LEDs.</p><p>For my project I chose a PWM resolution of one byte, or eight bits. A byte
allows for 256 possible output levels, plenty more than the eye can see in
brightness gradation. A resolution of 256 means that there are 256 “time slots”
wherein an LED can turn on or off.</p><p>For example, if the brightness of the LED is supposed to be 255, it is on from
time slot “0” all the way to time slot “255”—in other words, all the time. If
the brightness is 0, the LED is off for every cycle. If the brightness is 100,
the LED is on for the first hundred cycles, then off for the remaining 155.</p><p>The resulting output is not smooth, but a series of full-on and full-off
positions that, to the relatively slow human eye, average together to some
intermediate brightness. So, now we know roughly what the ISR should do:</p><ol><li><p>Read the desired brightness level of an LED, in the form of a global variable.</p></li><li><p>Read the current progress through the 256 cycles</p></li><li><p>Compare the brightness level to the current progress</p></li><li><p>If the progress is lower than the desired on-time, turn the LED on.</p></li><li><p>If the progress is past the desired on-time, turn the LED off.4.  Increment
the progress by one. AVR-LibC says that the ISR for the timer interrupt on the
tiny13 has the signature</p></li></ol><div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset:linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token function">ISR</span><span class="token punctuation">(</span>TIM0_OVF_vect<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div><p>The TIM0_OVF_vect parameter indicates that this ISR (potentially one of several)
is specifically for interrupts triggered by a TIMER0 overflow.</p><p>Given the pin number of each LED channel, and the brightness level desired, the
ISR body looks like:</p><div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset:linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token function">ISR</span><span class="token punctuation">(</span>TIM0_OVF_vect<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch1<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH1_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Write the ch1 pin high</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH1_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Write the ch1 pin low</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch2<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH2_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH2_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch3<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH3_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH3_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch4<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH4_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH4_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch5<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH5_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH5_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>

	ISRcounter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>where <code class="language-text">ch1, ch2, ..., ch5</code> are the single-byte output levels of each channel, and
<code class="language-text">CH1_PIN, CH2_PIN, ..., CH5_PIN</code> are the pin numbers for each channel.</p><p>The ISR is actually very simple:</p><p>ISRcounter holds the current count of ISR runs (0 to 255). For each channel, if
the ISRcounter is less than the brightness level desired for that channel, write
the LED HIGH (<code class="language-text">PORTB |= (1 &lt;&lt; pinNumber)</code>). Once the counter exceeds the desired
brightness level, keep writing the LED LOW (<code class="language-text">PORTB &amp;= ~(1 &lt;&lt; pinNumber)</code>). So,
in effect, the brightness level byte is simply the ON-time of the LED, out of
255.</p><p>The rest of the code can now fall into place:</p><div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset:linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">F_CPU</span> <span class="token expression"><span class="token number">9.6E6L</span> </span><span class="token comment">/* CPU Freq. Must come before delay.h include. 9.6MHz */</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token comment">/* For data types */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token comment">/* Register and port definitions */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token comment">/* Busy-wait delay functions */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token comment">/* Exposes timers, counters and ISR functions */</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH1_PIN</span> <span class="token expression">PB0 </span><span class="token comment">/* Bind output channels to specific PortB pins. This depends on schematic. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH2_PIN</span> <span class="token expression">PB1</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH3_PIN</span> <span class="token expression">PB2</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH4_PIN</span> <span class="token expression">PB3</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH5_PIN</span> <span class="token expression">PB4</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIME_OFFSET</span> <span class="token expression"><span class="token number">50</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DELAY_MS</span> <span class="token expression"><span class="token number">3</span></span></span>

<span class="token keyword">uint8_t</span> ch1<span class="token punctuation">,</span> ch2<span class="token punctuation">,</span> ch3<span class="token punctuation">,</span> ch4<span class="token punctuation">,</span> ch5<span class="token punctuation">;</span> <span class="token comment">/* The one-byte PWM level of each channel */</span>
<span class="token keyword">uint8_t</span> directions <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
<span class="token comment">/*
This one-byte flag holds five channel direction bit flags
0x [nothing] [nothing] [nothing] [ch5] [ch4] [ch3] [ch2] [ch1]
*/</span>

<span class="token keyword">volatile</span> <span class="token keyword">uint8_t</span> ISRcounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/* Count the number of times the ISR has run */</span>
<span class="token keyword">uint8_t</span> timeCount<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">/* Setup */</span>
	ch1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	ch2 <span class="token operator">=</span> TIME_OFFSET<span class="token punctuation">;</span>
	ch3 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> TIME_OFFSET<span class="token punctuation">;</span>
	ch4 <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> TIME_OFFSET<span class="token punctuation">;</span>
	ch5 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> TIME_OFFSET<span class="token punctuation">;</span>

	DDRB <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span> <span class="token comment">//Every PORTB pin is output</span>
	PORTB <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> <span class="token comment">//Start with every pin low</span>

	TCCR0B <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CS00<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// disable timer prescale (=clock rate)</span>
	TIMSK0 <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> TOIE0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// enable timer overflow interrupt specifically 	sei(); // enable interrupts in general 	/* Loop */ 	while(1){ 		if(directions &amp; 1) ch1++; 		else ch1--; 		if(directions &amp; 0B00000010) ch2++; 		else ch2--; 		if(directions &amp; 0B00000100) ch3++; 		else ch3--; 		if(directions &amp; 0B00001000) ch4++; 		else ch4--; 		if(directions &amp; 0B00010000) ch5++; 		else ch5--; 		if(ch1 &gt; 254) directions &amp;= ~0B00000001;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch1 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00000001</span><span class="token punctuation">;</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>ch2 <span class="token operator">&gt;</span> <span class="token number">254</span><span class="token punctuation">)</span> directions <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0B00000010</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch2 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00000010</span><span class="token punctuation">;</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>ch3 <span class="token operator">&gt;</span> <span class="token number">254</span><span class="token punctuation">)</span> directions <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0B00000100</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch3 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00000100</span><span class="token punctuation">;</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>ch4 <span class="token operator">&gt;</span> <span class="token number">254</span><span class="token punctuation">)</span> directions <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0B00001000</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch4 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00001000</span><span class="token punctuation">;</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>ch5 <span class="token operator">&gt;</span> <span class="token number">254</span><span class="token punctuation">)</span> directions <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0B00010000</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch5 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00010000</span><span class="token punctuation">;</span>

		<span class="token function">_delay_ms</span><span class="token punctuation">(</span>DELAY_MS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>Like all AVR-LibC programs, the main() function is divided into a setup phase,
which runs once at the time of power-up, and a loop phase, which runs after
setup as long as power is supplied. The setup function here sets the five LED
channels to a starting brightness with an interval determined by the macro
TIME_OFFSET, so-named because it simulates the amount of time by which each LED
leads the one “behind” it in the circular brightness pattern.</p><p>Then the loop logic uses a one-bit “direction” flag to decide whether to
increment or decrement the brightness of each channel, and finally a comparison
checks whether the direction needs to reverse (in case the LED is at minimum or
maximum brightness). The loop delays by time DELAY_MS, in milliseconds, and
starts again.</p><p>That’s it! Beyond setting up the timer details with the lines</p><div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset:linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">	TCCR0B <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CS00<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// disable timer prescale (=clock rate)</span>
	TIMSK0 <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> TOIE0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// enable timer overflow interrupt specifically</span>

	<span class="token function">sei</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// enable interrupts in general</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span></span></pre></div><p>as given in the ATtiny13 datasheet, the main() function and the ISR together
handle everything the program has to do to make pretty blinky lights.</p><p>There is one more step, actually. By default, the ATtiny13 ships with a 1/8th
clock prescaler enabled, a fuse called “CKDIV8” or “clock divide 8.” To make the
timer count quickly enough for the PWM to be invisible to the human eye, we need
to disable this clock divisor. To do so, we must run the command</p><div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset:linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token string">&quot;avrdude -c usbtiny -p t13 -U lfuse:w:0x7A:m&quot;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div><p>instructing avrdude to write 0x7A to the low fuse. This is the same as the
default low fuse value in every way but the CKDIV8 bit, which has been disabled.</p><p>The complete code:</p><div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset:linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token comment">/*
* Stardweeny Source Code
* Author: Travis Geis
* Version: 1
* Date: January 2012
* URL: http://zenlogic.org/
*
* file: main.c
*
* The Stardweeny project runs five channels of software PWM to
* control the five individual LEDs in the points of a paper star.
*
* Inspired by and dedicated to Linda Geis.
*
* For this code to work correctly, lfuse = 0x7A. (Disabling CKDIV8)
* Run the command &quot;avrdude -c usbtiny -p t13 -U lfuse:w:0x7A:m&quot;
*/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">F_CPU</span> <span class="token expression"><span class="token number">9.6E6L</span> </span><span class="token comment">/* CPU Freq. Must come before delay.h include. 9.6MHz */</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token comment">/* For data types */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token comment">/* Register and port definitions */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token comment">/* Busy-wait delay functions */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token comment">/* Exposes timers, counters and ISR functions */</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH1_PIN</span> <span class="token expression">PB0 </span><span class="token comment">/* Bind output channels to specific PortB pins. This depends on schematic. */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH2_PIN</span> <span class="token expression">PB1</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH3_PIN</span> <span class="token expression">PB2</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH4_PIN</span> <span class="token expression">PB3</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CH5_PIN</span> <span class="token expression">PB4</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIME_OFFSET</span> <span class="token expression"><span class="token number">50</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DELAY_MS</span> <span class="token expression"><span class="token number">3</span></span></span>

<span class="token keyword">uint8_t</span> ch1<span class="token punctuation">,</span> ch2<span class="token punctuation">,</span> ch3<span class="token punctuation">,</span> ch4<span class="token punctuation">,</span> ch5<span class="token punctuation">;</span> <span class="token comment">/* The one-byte PWM level of each channel */</span>
<span class="token keyword">uint8_t</span> directions <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
<span class="token comment">/*
This one-byte flag holds five channel direction bit flags
0x [nothing] [nothing] [nothing] [ch5] [ch4] [ch3] [ch2] [ch1]
*/</span>

<span class="token keyword">volatile</span> <span class="token keyword">uint8_t</span> ISRcounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/* Count the number of times the ISR has run */</span>
<span class="token keyword">uint8_t</span> timeCount<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
* int main(void):
*
* The main function runs automatically when the AVR powers up.
* It never returns, and so dispatches all other actions for the
* microcontroller.
*
* The goal is to make a sinusoidal light intensity with time.
*
*/</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">/* Setup */</span>
	ch1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	ch2 <span class="token operator">=</span> TIME_OFFSET<span class="token punctuation">;</span>
	ch3 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> TIME_OFFSET<span class="token punctuation">;</span>
	ch4 <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> TIME_OFFSET<span class="token punctuation">;</span>
	ch5 <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> TIME_OFFSET<span class="token punctuation">;</span>

	DDRB <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span> <span class="token comment">//Every PORTB pin is output</span>
	PORTB <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> <span class="token comment">//Start with every pin low</span>

	TCCR0B <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CS00<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// disable timer prescale (=clock rate)</span>
	TIMSK0 <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> TOIE0<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// enable timer overflow interrupt specifically 	 	sei(); // enable interrupts in general 	 	/* Loop */ 	while(1){ 		if(directions &amp; 1) ch1++; 		else ch1--; 		if(directions &amp; 0B00000010) ch2++; 		else ch2--; 		if(directions &amp; 0B00000100) ch3++; 		else ch3--; 		if(directions &amp; 0B00001000) ch4++; 		else ch4--; 		if(directions &amp; 0B00010000) ch5++; 		else ch5--; 		if(ch1 &gt; 254) directions &amp;= ~0B00000001;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch1 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00000001</span><span class="token punctuation">;</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>ch2 <span class="token operator">&gt;</span> <span class="token number">254</span><span class="token punctuation">)</span> directions <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0B00000010</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch2 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00000010</span><span class="token punctuation">;</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>ch3 <span class="token operator">&gt;</span> <span class="token number">254</span><span class="token punctuation">)</span> directions <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0B00000100</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch3 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00000100</span><span class="token punctuation">;</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>ch4 <span class="token operator">&gt;</span> <span class="token number">254</span><span class="token punctuation">)</span> directions <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0B00001000</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch4 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00001000</span><span class="token punctuation">;</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>ch5 <span class="token operator">&gt;</span> <span class="token number">254</span><span class="token punctuation">)</span> directions <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0B00010000</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ch5 <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> directions <span class="token operator">|=</span> <span class="token number">0B00010000</span><span class="token punctuation">;</span>

		<span class="token function">_delay_ms</span><span class="token punctuation">(</span>DELAY_MS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
* The ISR is responsible for toggling the states of the five output channels
* based on the current global variables for the desired brightness levels.
* Because the brightnesses (ch1 ... ch5) are single-byte values, the range
* of values is 0 to 255\. Thus the ISR needs to restart its counting cycle every
* 256th time it is called.
*
* To avoid undesired wiggle on the PWM, the ISR updates evey channel&#x27;s pin
* every time it runs. It should take the same number of cycles every time.
* The duty period of the PWM is the first section. Thus the LED goes ON then OFF.
*/</span>
<span class="token function">ISR</span><span class="token punctuation">(</span>TIM0_OVF_vect<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch1<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH1_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Write the ch1 pin high</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH1_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Write the ch1 pin low</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch2<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH2_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH2_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch3<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH3_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH3_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch4<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH4_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH4_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>ISRcounter <span class="token operator">&lt;</span> ch5<span class="token punctuation">)</span> PORTB <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH5_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> PORTB <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> CH5_PIN<span class="token punctuation">)</span><span class="token punctuation">;</span>

	ISRcounter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>Feel free to use the code any way you want. Have fun!</p><h2>Comments</h2><div id="cusdis_thread" data-host="https://travisgeis-cusdis.vercel.app" data-page-id="2012/01/11/software-pwm-on-the-attiny13/" data-app-id="bfc86e4c-f4e1-4135-8790-cf52804a5850" data-page-title="Software PWM on the ATtiny13" data-page-url="https://travisgeis.com/2012/01/11/software-pwm-on-the-attiny13"></div></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2012/01/11/software-pwm-on-the-attiny13/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-8b28952f62241afbe9f6.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-933a06e9dadf888491cb.js"],"component---src-pages-page-slug-tsx":["/component---src-pages-page-slug-tsx-6a9c919aefa8eb61bff6.js"],"component---src-pages-post-slug-tsx":["/component---src-pages-post-slug-tsx-d0a722fe664509218382.js"],"component---src-pages-project-slug-tsx":["/component---src-pages-project-slug-tsx-0058ca5e225b60a2429a.js"],"component---src-templates-index-tsx":["/component---src-templates-index-tsx-be59b2f1846831e4e707.js"]};/*]]>*/</script><script src="/component---src-pages-post-slug-tsx-d0a722fe664509218382.js" async=""></script><script src="/app-8b28952f62241afbe9f6.js" async=""></script><script src="/framework-065c3db88fdd2b546387.js" async=""></script><script src="/webpack-runtime-d8157e8dded65c3ff337.js" async=""></script></body></html>